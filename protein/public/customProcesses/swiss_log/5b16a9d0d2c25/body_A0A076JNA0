<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>SWISS-MODEL | Workspace</title><meta name="ROBOTS" content="ALL" /><meta name="description" content="The SWISS-MODEL Workspace provides a personal area for each user in which protein homology models can be built and the results of completed modelling projects are stored and visualized." /><link rel="stylesheet" type="text/css" href="/static/css/bootstrap-3.3.7.min.css" media="screen,print"/><link rel="stylesheet" type="text/css" href="/static/css/bootstrap-theme-3.3.7.min.css" media="screen,print"/><link rel="stylesheet" type="text/css" href="/static/css/master.css?v=1529927766"  media="all" /><link rel="stylesheet" type="text/css" href="/static/fancybox-2.1.4/jquery.fancybox.css"/><link rel="stylesheet" type="text/css" href="/static/jquery-ui-1.11.2.custom/jquery-ui.min.css"/><link rel="shortcut icon" href="/static/images/favicon.png" type="image/png" /><link rel="apple-touch-icon" href="/static/images/apple-touch-57.png" /><link rel="apple-touch-icon" sizes="72x72" href="/static/images/apple-touch-72.png" /><link rel="apple-touch-icon" sizes="114x114" href="/static/images/apple-touch-114.png" /><style>
  #inputForm .formHelp{font-size:.8em; font-style:italic}
  #id_target{ font-family:"Courier New", Courier, monospace; }
  #id_target{margin-bottom:0px;}
 .fresh{  }
 .notfresh{ color: #900; }
 .stale{ font-weight:bold; color:#F00; background-color:rgba(255,0,0,.2) }

.example_div{
  width:540px;
  border:1px solid #CCC;
  padding:4px;
  border-radius: 6px 6px 6px 6px;}
.example_button{ width:160px; padding:8px;}
.btn-group > .dropdown-toggle  { padding:8px; }

@media (max-width: 950px) {
img { border: 0 none;  max-width: 100%;}
}

</style><link rel="stylesheet" href="/static/css/jquery.fileupload-ui.css"></head><body><nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><button aria-controls="navbar" aria-expanded="false" data-target=".collapseThis" data-toggle="collapse" class="navbar-toggle collapsed" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="hidden-xs hidden-sm navbar-brand" style="margin-left:0px;padding:0px 4px 0px 0px;" 
				title="SIB Swiss Institute of Bioinformatics" 
				href="https://www.sib.swiss" target="_blank"><img src="/static/images/SIB_logo_20_sm.png" alt="SIB logo" style="max-height:50px"></a><a class="hidden-xs hidden-sm navbar-brand" style="margin-left:0px; padding:8px 0px 0px 4px;"
			title="Biozentrum | University of Basel | The Center for Molecular Life Sciences" 
			href="http://www.biozentrum.unibas.ch/" target="_blank"><img src="/static/images/biozentrum_en.png" alt="Biozentrum logo" style="max-height:36px"></a><a class="hidden-xs hidden-sm navbar-brand" href="/" style="margin-left:0px;padding-left:0px;padding-right:0px;font-size:28px;">SWISS-MODEL</a><a id="navbar-brand" class="hidden-md hidden-lg navbar-brand" href="/" style="margin-left:0px;font-size:20px;">SWISS-MODEL</a></div><div id="navbar" class="collapseThis navbar-collapse collapse"><!-- Collect the nav links, forms, and other content for toggling --><ul class="nav navbar-nav navbar-right"><li class="dropdown active"><a href="/interactive" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Modelling</a><ul class="dropdown-menu" role="menu"><li><a class="text-left" href="/interactive">myWorkspace</a></li><li><a class="text-left" href="/interactive#alignment">Alignment Mode</a></li><li><a class="text-left" href="/interactive#structure">User Template Mode</a></li><li><a class="text-left" href="/interactive#deepview">DeepView Project Mode</a></li><li class="divider"></li><li><a class="text-left" href="/templates/">Template Library</a></li></ul></li><li id="smrLink" class="dropdown "><a href="/repository" tabindex="-1">Repository</a></li><li class="dropdown "><a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Tools</a><ul class="dropdown-menu" role="menu"><li><a href="/qmean/" tabindex="-1">QMEAN</a></li><li><a href="/lddt" tabindex="-1">lDDT</a></li><li><a href="/assess">Structural Assessment</a></li></ul></li><li class="dropdown "><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Documentation</a><ul class="dropdown-menu" role="menu"><li><a href="/docs/help" tabindex="-1">SWISS-MODEL Help</a></li><li><a href="/docs/examples" tabindex="-1">Examples</a></li><li><a href="/docs/tutorial" tabindex="-1">Video Tutorial</a></li><li><a href="/docs/repository_help" tabindex="-1">Repository Help</a></li><li><a href="/course" tabindex="-1">Protein Structure Course</a></li><li><a href="/docs/references" tabindex="-1">References</a></li></ul></li><li><a onclick="showLogin();">Log in</a></li><li><a onclick="createAccount();">Create Account</a></li></ul></div></div><!-- /container-fluid --></nav><div id="tools"><div id="alignmentOptions" style="display:none;"><form class="alignmentOptions form form-inline"><div id="exportOptions"><h4>Export Alignment</h4><button class="btn btn-sm btn-default"
 onclick="$('#alignTbl'+$('#currentAlignmentIndex').val()).alignment('exportAlignment', {'format':'FASTA'}); return false;">FASTA format</button><button class="btn btn-sm btn-default"
  onclick="$('#alignTbl'+$('#currentAlignmentIndex').val()).alignment('exportAlignment', {'format':'ClustalW'}); return false;">Clustal Format</button><button type="button" class="btn btn-sm btn-default"
  onclick="$('.alTbl').first().alignment('html2image')">PNG Image</button></div><div><h4>Alignment Options</h4><div id="ssOptions"><div>
 Secondary Structure<br><label><input type="radio" name="sstype" id="secStruct_none" onclick="$('.alignTbl').alignment('secondaryStructure',{sstype:'none'})"  >None</label><label><input type="radio" name="sstype" id="secStruct_dssp" onclick="$('.alignTbl').alignment('secondaryStructure',{sstype:'dssp'})" checked="checked" />DSSP</label><label><input type="radio" name="sstype" id="secStruct_psipred" onclick="$('.alignTbl').alignment('secondaryStructure',{sstype:'psipred'})"  />PSIPRED</label><label><input type="radio" name="sstype" id="secStruct_sspro" onclick="$('.alignTbl').alignment('secondaryStructure',{sstype:'sspro'})"  />SSpro</label></div></div><div id="colourOptions" style="padding-top:8px">
  Colour Scheme <a class="smng-help" href="/docs/help#colour_schemes"></a><br><label><input type="radio" name="csRadioGroup" id="clustalButton" value="clustal"  />Clustal</label><label><input type="radio" name="csRadioGroup" id="hydrophobicButton" value="hydrophobic"  />Hydrophobic</label><label><input type="radio" name="csRadioGroup" id="sizeButton" value="size"  />Size</label><label><input type="radio" name="csRadioGroup" id="chargedButton" value="charged"  />Charged</label><label><input type="radio" name="csRadioGroup" id="polarButton" value="polar"  />Polar</label><label><input type="radio" name="csRadioGroup" id="prolineButton" value="proline"  />Proline</label><label><input type="radio" name="csRadioGroup" id="serThrButton" value="serThr"  />Ser/Thr</label><label><input type="radio" name="csRadioGroup" id="cysButton" value="cysteine"  />Cysteine</label><label><input type="radio" name="csRadioGroup" id="aliphaticButton" value="aliphatic"  />Aliphatic</label><label><input type="radio" name="csRadioGroup" id="aromaticButton" value="aromatic"  />Aromatic</label><label title="Solvent Accessibility"><input type="radio" name="csRadioGroup" id="soaButton" value="soa"  />SOA</label><label><input type="radio" name="csRadioGroup" id="bvalueButton" value="bvalue" >bValue</label><label><input type="radio" name="csRadioGroup" id="bvalueRangeButton" value="bvalue_range" >bValue Range</label><label title="Conservation"><input type="radio" name="csRadioGroup" id="entropyButton" value="entropy"  />Entropy</label><label><input type="radio" name="csRadioGroup" id="chainButton" value="chain" >Chain</label><label><input type="radio" name="csRadioGroup" id="uniqueChainButton" value="uniqueChain" >Unique Chain</label><label><input type="radio" name="csRadioGroup" id="rainbowButton" value="rainbow" checked="checked">Rainbow</label><label><input type="radio" name="csRadioGroup" id="secstrucButton" value="secstruc" checked="checked">Structure</label><br style="clear:both"><label><input type="radio" name="csRadioGroup" id="noColourButton" value="none"  />No Colour</label></div></div></form><div id="formattedAlignment" style="width:610px;height:470px;" class="fancy_box_swap"><label class="checkbox-inline" ><select style="height:28px;width:150px;" class="form-control" name="alignmentFormatSelect" id="alignmentFormatSelect" onchange="$('.alignTbl').first().alignment('changeExportFormat')"><option value="FASTA" selected="selected">FASTA</option><option value="Multi FASTA">Multi FASTA</option><option value="ClustalW">ClustalW</option></select></label><button type="button" class="btn btn-sm btn-default" onclick="$('.alignTbl').first().alignment('html2image')">PNG</button><div align="center"><textarea name="formattedAlignmentTextarea" id="formattedAlignmentTextarea" style="margin-top:8px;font-family:'Courier New', Courier, monospace; font-size:12px;width:100%;height:400px"></textarea></div></div></div><input type="hidden" id="currentAlignmentIndex" value=""></div><div id="main-content" style="padding-left:32px; margin-right:32px"><div class="row" style="background-color:#FFF; border-collapse:separate; border:1px solid #DDD; border-radius: 10px; padding:8px;"><div class="col-sm-12"><h4>Start a New Modelling Project <a class="smng-help" href="/docs/help#new_project"></a></h4></div><div class="col-sm-9" ><!-- this is the left panel --><form style="margin:0px" id="inputForm" enctype="multipart/form-data" method="post" action="/interactive"><input type='hidden' name='csrfmiddlewaretoken' value='dEAlhd3FksZUntNZTTcBP9rCTnXVHX1vq5uYiJfHwC3PBhGoLCNEnod7j6RAWnyG' /><input type="hidden" id="is_alignment" name="is_alignment" value="false" type="hidden"><div align="center" id="validation_div"></div><div class="row" id="multiple_sequence_selector" style="display:none;padding:8px;margin-bottom:16px;border:1px solid #D00;border-radius: 8px;"><div class="col-sm-10 col-sm-offset-2"><div class="row">SWISS-MODEL could not create a valid target-template alignment from the uploaded sequences. Please identify which sequence should be used for target and which sequence for template:</div></div><div class="col-sm-11 col-sm-offset-1"><div class="row"><div style="width:200px;float:left;text-align:right;">Target:
          <select style="display:inline;width:130px" class="form-control" id="msa_trg_select" onchange="$('#msa_trg_sequence').text( $(this).find(':selected').attr('seq') );" onkeyup="$('#msa_trg_sequence').text( $(this).find(':selected').attr('seq') );"></select></div><div style="overflow:auto; white-space: nowrap; font-family: 'Courier New',Courier,monospace"><div id="msa_trg_sequence" style="padding-top:7px"></div></div></div><div class="row"><div style="width:200px;float:left;text-align:right">Template:
          <select style="display:inline;width:130px" class="form-control" id="msa_tpl_select" onchange="$('#msa_tpl_sequence').text( $(this).find(':selected').attr('seq') );" onkeyup="$('#msa_tpl_sequence').text( $(this).find(':selected').attr('seq') );"></select></div><div style="overflow:auto; white-space: nowrap; font-family: 'Courier New',Courier,monospace"><div id="msa_tpl_sequence" style="padding-top:7px"></div></div></div><div class="text-center" style="padding:20px 0px 4px 0px;"><button type="button" class="btn btn-primary" onclick="validateTrgTplSelection();">Validate Target-Template Alignment</button></div></div></div><div class="row"><div id="alignmentSelectDiv"></div></div><div class="row" id="targetInputRow"><div class="col-sm-2"><span id="target_sequence_label">Target Sequence</span>:
<br><span class="formHelp">(Format must be FASTA, Clustal,<br>plain string, or a valid UniProtKB AC)</span></div><div class="col-sm-10"><textarea name="target" rows="6" id="id_target" required placeholder="Paste your target sequence(s) or UniProtKB AC here" cols="40" class="form-control"></textarea></div></div><div class="row" id="sequenceFileUploadRow"><div class="col-sm-10 col-sm-offset-2"><span class="btn btn-success fileinput-button pull-left " style="margin-bottom:12px;"><i class="glyphicon glyphicon-plus" style="opacity:0.6"></i><span id="sequenceFileLabel"> Upload Target Sequence File...</span><input id="id_sequence_file_upload" type="file" name="sequence_file_upload" ></span><div id="sequenceFileUploadProgress" style="margin-left:16px;display:none" class="pull-left"><img  src="/static/images/loadingBar.gif"></div><button style="margin-left:8px;" id="validateInputButton" class="btn btn-default disabled" type="button" onclick="var e = $.Event('keyup');e.which = 13; e.keyCode = 13; $('#id_target').trigger(e);"><i class="glyphicon glyphicon-check"
        title="Validate Input - or press return key"></i> Validate</button></div></div><div class="row" id="templateFileUploadRow" style="display:none;"><div class="col-sm-2">Template File:</div><div class="col-sm-10"><span class="btn btn-success fileinput-button "><i class="glyphicon glyphicon-plus" style="opacity:0.6"></i><span id="templateFileLabel">Add Template File...</span><input id="id_template_file_upload" type="file" name="template_file_upload" ></span><div id="templateFileUploadProgress" style="margin-left:16px;display:none"><img  src="/static/images/loadingBar.gif"></div></div></div><div class="row" style="display:none"><div class="col-sm-2">Template Sequence:
<br><span class="formHelp">(Not Visible)</span></div><div class="col-sm-10"><textarea name="aligned_template" rows="5" cols="40" id="id_aligned_template"></textarea></div></div><div class="row" id="projectTitleRow"><div class="col-sm-2">Project Title:</div><div class="col-sm-10"><input type="text" name="project_title" id="id_project_title" placeholder="Untitled Project" class="form-control" maxlength="256" /></div></div><div class="row"><div class="col-sm-2">
Email:
   </div><div class="col-sm-10"><input type="email" name="email" placeholder="Optional" class="form-control" id="id_email" /></div></div><div class="row"><div class="col-sm-2"></div><div class="col-sm-5" style="padding-top:8px;"><button id="searchButton" type="button" class="btn btn-block btn-lg btn-primary disabled" disabled="disabled" onclick="validateForm(false)">Search For Templates</button></div><div class="col-sm-5" style="padding-top:8px;"><button id="buildButton" type="button" class="btn btn-block btn-lg btn-primary disabled" disabled="disabled" onclick="validateForm(true)">Build Model</button></div><div class="col-sm-10 col-sm-offset-2" style="margin-top:20px; font-style:italic; font-size:12px;">
    By using the SWISS-MODEL server, you agree to comply with the following <a href="/docs/terms_of_use">terms of use</a> and to cite the corresponding <a href="/docs/references">articles</a>.<br></div></div><input type="hidden" name="automodel" value="false" id="id_automodel" /><input type="text" id="id_whatDoesThisDo" name="whatDoesThisDo" style="display:none;"></form></div><!-- End of left column --><div class="col-sm-3 text-center" style="padding:0"><div style="font-size:1.2em;margin-bottom:8px;">Supported Inputs <a class="smng-help" href="/docs/help#input_data"></a></div><div class="btn-group"><a onclick="changeMode('sequence');return false;" id="sequence_button" class="btn btn-default btn-sm example_button active">Sequence(s)</a><button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Example Input"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li class="text-center" onclick="fillExample('sequence');return false;"><a href="#sequence">Single Target Example</a></li><li class="text-center" onclick="fillExample('multi_target');return false;"><a href="#hetero">Multiple Target Example</a></li><li class="divider"></li><li class="text-center" onclick="fillExample('uniprot');return false;"><a href="#uniprot">UniProtKB AC</a></li></ul></div><br><div class="btn-group"><a onclick="changeMode('alignment');return false;" id="alignment_button" class="btn btn-default btn-sm example_button">Target-Template Alignment</a><button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Example Input"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li class="text-center" onclick="fillExample('alignment');return false;"><a href="#alignment">Example</a></li></ul></div><br><div class="btn-group"><a onclick="changeMode('structure');return false;" id="structure_button" class="btn btn-default btn-sm example_button">User Template</a><button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Example Input"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li class="text-center" onclick="fillExample('structure');return false;"><a href="#structure">Example</a></li></ul></div><br><div class="btn-group"><a onclick="changeMode('deepview');return false;" id="deepview_button" class="btn btn-default btn-sm example_button">DeepView Project</a><button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Example Input"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li class="text-center" onclick="fillExample('deepview');return false;"><a href="#deepview">Example</a></li></ul></div></div></div><!-- end of right panel --><div id="example_sequence" class="fancy_box_swap example_div"><p>When a protein amino acid sequence is pasted into the textarea, the input text is immediately validated and if valid
 replaced with an interactive sequence view. 
</p><p>
The format of the sequence must be either FASTA, Clustal or raw sequence.</p><p>You may also upload the sequence as a file.</p><p>
As an example, we will paste the sequence:<br><pre>
>Target
SNAGNSTTSDKGTEEATTSAFDVMSQFNEIGVSYPLTVTDQAGRTVTFEKAPEKIASSYYISTSLLLALGLQ
DKLVGIEAKANTRNIYKLAAPAIVSLPNMGTAKEFNTEACVAATPDVVFLPMKLKKTADTLESLGIKAVVVN
PEDQSLLEECITLVGKITNNAGRAEALNNSIKTFLADNKTNVSGGNTPSVYLAGNSSVLSTAGSKMYQNTLL
TNAGGKNVASELTDTYWANVSYEQILAWNPDYIVIAADATYTVDDILNDANLAGCNAVKNKNVVKLPNNIEA
WDSPVPGSFLGSIYIASVLHPEKVTKDFYETCVTKFYESFYGFTPAK
</pre><p style="text-align:center"><button class="btn btn-info" onclick="$.fancybox.close();">Continue</button></p></div><div id="example_alignment" class="fancy_box_swap example_div" ><p>
If the desired template for modelling is known and is found in the SMTL, 
an alignment of target-template in either FASTA or Clustal format may be used to start modelling without
the need for a template search.</p><p>1: Preferably the first sequence in alignment should be the target protein amino acid sequence.</p><p>2: Preferably the template sequence(s) are named as per PDB id format. eg "1CRN", "1CRNA" or "1CRN_A".</p><p>3: If a valid target-template alignment is identified by SWISS-MODEL, the alignment will be displayed. Otherwise, please specify the target and/or template from a drop down list which will be displayed.
<p>4: It is possible there are more than one biounits for your template, if so you will see several alignments
from which you must make a selection to build a model.
</p><p> 
As an example we will paste the following target/template alignment: </p><pre>
>THN_DENCL
KSCCPTTAARNQYNICRLPGTPRPVCAALSGCKIISGTGCPPGYRH
>1crnA
TTCCPSIVARSNFNVCRLPGTPEAICATYTGCIIIPGATCPGDYAN</pre><br><p style="text-align:center"><button class="btn btn-info" onclick="$.fancybox.close();">Continue</button></p></div><div id="example_uniprot" class="fancy_box_swap example_div"><p>When a UniProtKB AC is pasted in the textarea, the input is immediately validated and 
replaced with an interactive sequence view.</p><p>As an example, we will paste the UniProtKB AC <b>P61851</b></p><br><p style="text-align:center"><button class="btn btn-info" onclick="$.fancybox.close();">Continue</button></p></div><div id="example_structure" class="fancy_box_swap example_div"><p>It is possible to specify the structure to be used as modelling template 
 by uploading a file in PDB format (*) with coordinates of the template structure.</p><p>1: Enter the target protein amino acid sequence as normal in the textarea.</p><p>Example: <br><pre>>sp|P61851|SODC_DROME
MVVKAVCVINGDAKGTVFFEQESSGTPVKVSGEVCGLAKGLHGFHVHEFGDNTNGCMSSG
PHFNPYGKEHGAPVDENRHLGDLGNIEATGDCPTKVNITDSKITLFGADSIIGRTVVVHA
DADDLGQGGHELSKSTGNAGARIGCGVIGIAKV</pre><br><p>2: Upload your template file - please make sure that this file contains
 only a single protein chain, and does not contain chemically modified amino acids, hetero atoms, ligands, etc.</p>
For example, after entering the target sequence above, download <a href="/templates/3l9y.1.A.pdb" target="_blank">this file</a>, then click the "Add Template File" button (or simply drag the file onto the button) 
<br><br><p style="text-align:center"><button class="btn btn-info" onclick="$.fancybox.close();">Continue</button></p></div><div id="example_deepview" class="fancy_box_swap example_div"><p>The program DeepView (Swiss-PdbViewer, Guex et al.) can be used to generate, display, analyze and manipulate modelling project files for the SWISS-MODEL workspace.</p><p>
Project files contain the superposed template structures, and the alignment between the target and template.
 The user has therefor full control over essential modelling parameters, i.e. the choice of template structures,
  the correct alignment of residues, and the placement of insertions and deletions in the context of the
   three-dimensional structure.</p><p>Here is an <a href="/static/tutorial_dimerAB.pdb" target="_blank">example DeepView Project file.</a></p><p>DeepView can be downloaded from the <a href="http://www.expasy.org/spdbv/" target="_blank">DeepView Home website</a>.</p><br><p style="text-align:center"><button class="btn btn-info" onclick="$.fancybox.close();">Continue</button></p></div><div id="example_multi_target" class="fancy_box_swap example_div"><p>It is possible to input multiple sequences to model an hetero-oligomer or a protein complex.</p><p>1: Enter the first target protein amino acid sequence or UniProt AC as normal in the textarea.</p><p>Example: <br><pre>P09904</pre><p>2: Hit the "Add Hetero Target" button and enter an additional amino acid sequence.</p><pre>>HBB_PHYCD P09905 Hemoglobin subunit beta-1/2
VHLTGEEKSGLTALWAKVNVEEIGGEALGRLLVVYPWTQRFFEHFGDLSTADAVMKNPKVKKHGQKVLASFG
EGLKHLDNLKGTFATLSELHCDKLHVDPENFRLLGNVLVVVLARHFGKEFTPELQTAYQKVVAGVANALAHK
YH</pre><p>3: Repeat Step 2 untill you entered the amino acid sequences of all the interacting partners.</p><p></p><p style="text-align:center"><button class="btn btn-info" onclick="$.fancybox.close();">Continue</button></p></div><div class="row"><div style="background-color:#FFF; border:1px solid #DDD; border-radius: 10px; padding:8px;margin-top:24px;"><h5>You are currently not logged in - to take advantage of the workspace, please <a onclick="showLogin();">log in</a> or <a onclick="createAccount();">create an account</a>.</h5><i><small>(There is no requirement to create an account to use any part of SWISS-MODEL, however you will gain the benefit of seeing a list of your previous modelling projects here.)</small></i><!-- Modal --><div id="delProjectDiv" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button><h3>Delete Project - "<span id="delProjectDivLabel"></span>"</h3></div><div class="modal-body"><p>Are you sure you want to delete this project?<br>(This really can't be undone!)</p></div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Close</button><button class="btn btn-danger" id="confirmDeleteButton" >Delete Project</button></div></div></div></div><!-- END OF PROJECT LIST --></div></div><div id="blankAlignment" style="display:none;"><div class="row" style="margin-bottom:16px;"><div id="alignmentWarning_TEMPLATE"></div><div id="alignScroll_TEMPLATE" style="width:100%; height:110px; margin-bottom:4px;"><div style="width:100%; height:100%; overflow-y:auto;overflow-x:hidden; margin-bottom:6px; border-bottom:1px dashed #CCC"><table cellpadding="0" cellspacing="0" class="alignTblContainer"><tr><td valign="top"><div class="hidden-print"><a id="options_TEMPLATE" href="#" onclick="return false;" class="glyphicon glyphicon-cog" style="color:#333;opacity:.7;margin-right:2px"></a></div><div class="hidden-print"><a id="gapEdit_TEMPLATE" href="#" onclick="$('#alignTblTEMPLATE').alignment('toggleEditMode');return false;" class="glyphicon glyphicon-edit" style="opacity:.6;color:#333;margin-right:2px;"></a></div></td><td valign="top"><table class="alignNameTbl" id="alignNameTblTEMPLATE" border="0" cellspacing="0" cellpadding="0"></table></td><td valign="top"><table class="alignTbl" id="alignTblTEMPLATE" cols_cookie="input_cols" border="0" cellspacing="0" cellpadding="0" ></table><div id="alignTblTEMPLATE_features" style="z-index:-1; position: absolute;"></div></td></tr></table><div id="offscreen_selection" style="position:absolute; top:-500px;"></div></div></div><span class="seqIdLabel" style="float:right;padding-right:14px;">Sequence Identity: 
      <span id="seqid_tpl_TEMPLATE"></span></span><button style="display:none" id="addMultiTargetButton" type="button" class="btn btn-success" onclick="addMultiTarget();"><i class="icon icon-plus" style="opacity:0.6"></i>Add Hetero Target</button><button style="display:none;" type="button" class="startJobButton btn btn-lg btn-primary" onclick="modelThis('TEMPLATE')" >Build Model</button><button style="margin-left:10px;" type="button" class="btn btn-sm btn-default" onclick="resetForm()" ><i class="glyphicon glyphicon-refresh"></i> Reset</button></div></div></div><div id="loginForm" style="width:600px;display:none;padding-top:12px; text-align:center;"></div><footer class="footer hidden-print"><div id="sib_footer"><ul class="list-inline" style="margin-bottom:0px; padding-bottom:4px;padding-top:4px;"><li><a href="https://www.sib.swiss">Swiss Institute of Bioinformatics</a></li><li><a href="https://www.biozentrum.unibas.ch/research/groups-platforms/overview/unit/schwede/">Schwede Group</a></li><li><a  href="mailto:mouseover@for.address" class="swissmodelContactRef">Contact Us</a></li><li><a href="/docs/terms_of_use">Terms of use</a></li><li class="pull-right"><a id="sib_footer_gototop" onclick="window.scrollTo(0,0);"><i class="glyphicon glyphicon-arrow-up"></i> Back to the Top</a></li></ul><div class="clearfix"></div></div></footer><script src="/static/js/jquery-3.2.1.min.js"></script><script src="/static/jquery-ui-1.11.2.custom/jquery-ui.min.js"></script><script src="/static/js/bootstrap-3.3.7.min.js"></script><script src="/static/js/jquery.tablesorter-2.0.5.min.js"></script><script src="/static/fancybox-2.1.4/jquery.fancybox.pack.js"></script><script index.html src="/static/js/alignment.min.js?v=1529927766"></script><script index.html src="/static/js/raphael-min.js"></script><script index.html src="/static/js/vendor/jquery.ui.widget.min.js"></script><script index.html src="/static/js/jquery.iframe-transport.js"></script><script index.html src="/static/js/jquery.fileupload.min.js"></script><script index.html src="/static/js/svgtocanvas.min.js?v=1524669021"></script><script>
function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    crossDomain: false,
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type)) 
            xhr.setRequestHeader("X-CSRFToken", "dEAlhd3FksZUntNZTTcBP9rCTnXVHX1vq5uYiJfHwC3PBhGoLCNEnod7j6RAWnyG");
    }
});

//This obfuscation is just to stop bots from following the link

var validateFileUrl=['/validateFile','/inter','active'];

var validateSeqinputUrl=['/validate','/inter','active'];

$(function () {


    $('#id_sequence_file_upload').fileupload({
        url: validateFileUrl[1]+validateFileUrl[2]+validateFileUrl[0],
        dataType: 'json',
        dropZone: $('#id_target'),
        maxFileSize: 50
    }).on('fileuploadadd', function (e, data) 
    {
      $('#inputForm input[name=multiTargetValidate]').remove();
      $('#inputForm textarea[id^=multiTargetInput]').each(
          function()
          {
            $('#inputForm').append(
                '<input type="text" name="multiTargetValidate" value="'
                  +$(this).val()+'">');
          });

      $("#is_alignment").val(window.location.hash=='#alignment');
      $('#sequenceFileUploadProgress').show();
    }).on('fileuploaddone', function (e, data) 
    {
        $('#inputForm input[name=multiTargetValidate]').remove();
        validationResults(data.result);
        $('#sequenceFileUploadProgress').hide();
    }).on('fileuploadfail', function (e, data) 
    { 
      $('#inputForm input[name=multiTargetValidate]').remove();  
      $('#validation_div').html('<span class="errorlist">Failed to upload file. Please try again and contact us if this problem persists.</span>');
      $('#sequenceFileUploadProgress').hide(); 
    });
});
$(function () {
    $('#id_template_file_upload').fileupload({
        url: validateFileUrl[1]+validateFileUrl[2]+validateFileUrl[0],
        dataType: 'json',
        replaceFileInput:false,
        dropZone: '',
        maxFileSize:50
    }).on('fileuploadadd', function (e, data) 
    {
        $('#templateFileUploadProgress').show();
    }).on('fileuploaddone', function (e, data) 
    {
        // add file name to results to show user which file was uploaded
        data.result.filename = data.files[0].name;
        validationResults(data.result);
        $('#templateFileUploadProgress').hide();
    }).on('fileuploadfail', function (e, data) 
        { $('#validation_div').html('<span class="errorlist">Failed to upload file. Please try again and contact us if this problem persists.</span>');
           $('#templateFileUploadProgress').hide(); 
        });
});


$(window).on('hashchange', function(e) 
{
  if(fillingExample)
      return;
  e.preventDefault();
  changeMode(window.location.hash);
});


$(document).ready(function() { 

    $(window).resize(function() {
          //By using clearTimeout, we dont resize the alignment every 20ms
          clearTimeout(this.id);
          this.id = setTimeout(function(){
            $('.alignTbl').alignment('resizeToParent');}, 400); 
        });

  

    

    $('#alignTblTEMPLATE_features').remove();
    $('#ssOptions').remove();
		$('button[id^="plus7"]').on('click',
				function()
				{
          //This obfuscation is just to stop bots from following the link
          
					var id=$(this).attr('id').substring(6);					
          var url = ['/xxxxxx/plus7','/inter','active'];
					$.post( (url[1]+url[2]+url[0]).replace('xxxxxx',id),
		                      function(d,s)
		                      {
                            if(s=='success')
                            {
                              $('#expires_'+id)
                                .contents()
                                .filter(function(){ return this.nodeType == 3; }).remove();
                              $('#expires_'+id)
                                .prepend('Next week ')
                                .removeClass()
                                .attr('title','Project will be deleted on '+d['expires']);
                              $('#plus7_'+id).remove();
                            }
		                      });		                      
				});


    $('#id_target').focus();
    $("#id_target").on('paste keyup',
        function(e)
        {
          window.id = setTimeout(function()
          {
              var target = $('#id_target').val().replace(/^\s+/,'').replace(/\s+$/,'');
              if(target.length<6)
              {
                $('#validation_div').html('');
                $('#validateInputButton')
                    .attr("disabled", "disabled")
                    .addClass("disabled");
                return;
              }
              if(target.length>12 && target.length<30)
              {
                $('#validation_div').html('<span class="errorlist">The target sequence must be longer than 30 residues.</span>');
                $('#validateInputButton')
                    .attr("disabled", "disabled")
                    .addClass("disabled");
                return;
              }

              if(e.type=='keyup')
              {
                $('#validateInputButton')
                    .removeAttr("disabled")
                    .removeClass('disabled'); 
              }
              var code = (e.keyCode ? e.keyCode : e.which);
              if(e.type=='keyup' && code!=13)
                return;

              var data = 'target='+target
                  +'&is_alignment='+(window.location.hash=='#alignment');

              $('textarea[id^=multiTargetInput]').each(
                  function()
                  {
                    data+='&multiTargetValidate='+$(this).val();
                  });


	            $.post(validateSeqinputUrl[1]+validateSeqinputUrl[2]+validateSeqinputUrl[0],
                      data,
                      function(data, s)
                      { 
                    	  if(s=='success')
                    		  validationResults(data);
                    	  else
                    		  $('#validation_div').html('Unknown Server Error'); 
                    	}
                      ,"json").fail(function(e,b){ console.info(b)}); 
            },150);
        });

    if($("#id_target").val().length>1 && $('.errorlist').length==0)
    	$("#id_target").trigger('paste');
    
     if(window.location.hash)
     {
       changeMode(window.location.hash.substring(1));
     }
     else
     {
        var ac = window.location.search.substring(1).split('=');
        if(ac.length==2 && ac[0]=='ac')
        {
          $('#id_target').val(ac[1])
            .trigger('paste');
        }
     }


    $('button[id^=del]').click(
    function()
    {
      confirmDeleteProject($(this).attr('id').substring(4));
    });

    

  } 
);


function changeMode(mode)
{
  if(window.location.hash.indexOf('#')==-1 || window.location.hash!='#'+mode)
    window.location.hash = mode;

  mode = window.location.hash.substring(1);

  $(".example_button").removeClass("active");
  $("#"+mode+"_button").addClass("active");

  resetForm();
  $('#targetInputRow,#templateFileUploadRow,#pdbRow,#searchButton,#buildButton').hide();
  $('#searchButton').parent().hide();
  $('#sequenceFileLabel').html(' Upload Target Sequence File...');
  if(mode=='alignment')
  {
    $('#target_sequence_label').text("Target-Template Alignment");
    $('#id_target').attr('placeholder','Paste your target-template alignment here');
    $('#sequenceFileLabel').html(' Upload Target-Template Alignment File...');
    $('#targetInputRow,#sequenceFileUploadRow').show();
  }
  else if(mode=='structure')
  {
    $('#templateFileLabel').html(' Add Template File...');
    $('#id_template_file_upload')
      .fileupload('disable')
      .prop('disabled','disabled')
        .parent()
        .addClass("disabled");  
    $('#targetInputRow,#templateFileUploadRow,#buildButton,#sequenceFileUploadRow').show();
  }
  else if(mode=='deepview')
  {
    $('#id_template_file_upload')
      .fileupload('enable')
      .prop('disabled','')
        .parent()
        .removeClass("disabled");
    $('#sequenceFileUploadRow').hide();
    $('#templateFileLabel').html(' Add DeepView Project File...');
    $('#templateFileUploadRow,#buildButton').show();
  }
  else //Also, make this default mode=='sequence')
  {
    $('#targetInputRow,#searchButton,#buildButton,#sequenceFileUploadRow').show();
    $('#searchButton').parent().show();
    var ac = window.location.search.substring(1).split('=');
    if(ac.length==2 && ac[0]=='ac')
    {
      $('#id_target').val(ac[1])
           .trigger('paste');
    }
  }

}

var fillingExample = false;
function fillExample(type, e)
{
  changeMode(type=='multi_target'?'sequence':type);
  fillingExample = true;
  if(type=='sequence')
  {
    $('#id_project_title').val('Ornithine Carbamoyltransferase Example');
    $('#id_target').val('>Target\n'
      +'MGGEALTLPKDLLDFSGYGPKELQALLDLAERLKRERYRGEDLKGKVLALLFEKPSLRTRTTLEVAMVHLGG\n'
      +'HAVYLDQKQVGIGEREPVRDVAKNLERFVEGIAARVFRHETVEALARHAKVPVVNALSDRAHPLQALADLLT\n'
      +'LKEVFGGLAGLEVAWVGDGNNVLNSLLEVAPLAGLKVRVATPKGYEPDPGLLKRANAFFTHDPKEAALGAHA\n'
      +'LYTDVWTSMGQEAERAKRLRDFQGFQVNGELLKLLRPEGVFLHCLPAHYGEETTEEAVHGPRSRVFDQAENR\n'
      +'LHTAKAVLLTLLK').show();
  }
  else if(type=='uniprot')
  {
    $('#uniprot_input').val('P61851');
    $('#id_target').val('P61851').show();
  }
  else if(type=='alignment')
  {
    $('#id_target').val('>THN_DENCL\n'
        +'KSCCPTTAARNQYNICRLPGTPRPVCAALSGCKIISGTGCPPGYRH\n'
        +'>1crnA\n'
        +'TTCCPSIVARSNFNVCRLPGTPEAICATYTGCIIIPGATCPGDYAN');
  }
  else if(type=='structure')
  { }
  else if(type=='deepview')
  {  }
  else if(type=='multi_target')
  {
    $('#id_project_title').val('Hemoglobin Example');
    $('#id_target')
      .val('P09904')
      .show()
      .trigger('paste');
  }


  $('#example_'+type).show()
  $('#singleSequence').hide();
  $("<a href='#example_"+type+"'/>'").fancybox(
        {'width' :500, 'height' :600,'showCloseButton':false,
        'beforeClose': function() 
        {  
         $('#id_target').trigger('paste');
         fillingExample = false;
        },
        'afterClose': function()
        {
          if(type=='multi_target')
           {
              addMultiTarget();
              addValidatedSequence('VHLTGEEKSGLTALWAKVNVEEIGGEALGRLLVVYPWTQRFFEHFGDLSTADAVMKNPKVKKHGQKVLASFG'
                               +'EGLKHLDNLKGTFATLSELHCDKLHVDPENFRLLGNVLVVVLARHFGKEFTPELQTAYQKVVAGVANALAHKYH');
           }
        } }).trigger('click');  
}

function editText(src, id, type)
{
  if($('#edit_'+id+type).length>0)
    return;

  $('#title_'+id).after('<div class="input-group">'
        +'<input class="form-control" type="text" id="edit_'+id+type+'" value="'+ $('#title_'+id).text()+'" maxlength="255"  style="width:300px" />'
        +'<button type="button" class="btn btn-sm btn-default" onclick="saveText(\''+id+type+'\',true,event)" >Save</button>'
        +'<button type="button" class="btn btn-sm btn-default" onclick="saveText(\''+id+type+'\',false,event)" >Cancel</button>'
        +'</div>'
    );

  $('#title_'+id).hide();

  $('#edit_'+id+type).focus();
}
function saveText(id, save, event)
{
  event.stopPropagation();
  var type = id.substring(6);
  var id = id.substring(0,6);
  if(save)
  {
    var val = $('#edit_'+id+type).val();
    $('#title_'+id+' a').text( val );
    $.post("/interactive/edit",
                { 
                  project:id,
                  field:type,
                  value:val,
                  csrfmiddlewaretoken:'dEAlhd3FksZUntNZTTcBP9rCTnXVHX1vq5uYiJfHwC3PBhGoLCNEnod7j6RAWnyG' 
                }, 
                
                function(data, s)
                {
                   if(s=='success')
                   {
                     $('#title_'+id).css('background-color','#6D6');
                     setTimeout( function(){ $('#title_'+id).css('background-color',''); },1500);   
                   }
                   else
                     alert('Unknown Error: Details were not updated!');  
                });
  }
  $('#title_'+id).show();
  $('#edit_'+id+type).parent().remove();
}

//Should we focus on the confirm delete button or not?
$('#delProjectDiv').on('shown.bs.modal', function (e) {
  $('#confirmDeleteButton').focus();
});

function confirmDeleteProject(id)
{
  $('#delProjectDivLabel').text($('#title_'+id+' a').text());
  $('#delProjectDiv').modal('show');   
  $('#confirmDeleteButton')
    .off('click')
    .on('click',function()
      {
        //This obfuscation is just to stop bots from following the link
        
        var url = ['/xxxxxx/delete','/inter','active'];
        $.post( (url[1]+url[2]+url[0]).replace('xxxxxx',id),
            { 
              csrfmiddlewaretoken:'dEAlhd3FksZUntNZTTcBP9rCTnXVHX1vq5uYiJfHwC3PBhGoLCNEnod7j6RAWnyG' 
            },
            function(d,s)
            {               
              if(s=='success')
                $('#prj_details_'+id).remove();
            }); 
          $('#delProjectDiv').modal('hide');        
      });
}



function validateTrgTplSelection()
{
  var trg = $('#msa_trg_select option:selected').first();
  var tpl = $('#msa_tpl_select option:selected').first();
  if(trg.val()+trg.attr('seq')==tpl.val()+tpl.attr('seq'))
    alert('Target sequence cannot be the same as template sequence!');
  else
  {
    changeMode('alignment');
    var aln = ">"+trg.val()+"\n"+trg.attr('seq')
            + "\n>"+tpl.val()+"\n"+tpl.attr('seq');
    $('#id_target').val(aln).trigger('paste');
    $('#multiple_sequence_selector').hide();
  }
}

function validationResults(data)
{
     $('#validation_div').html('');
		 if(!data.structure_file)
     {
       $('#targetInputRow').show();
  		 $('#alignmentSelectDiv').html('');
  		 $('#singleSequence').remove();  	 
       $('#validation_div').html('');
     }

     $('#fileUploadMessage').remove();

     if(!data.error)
     {
      $('#id_template_file_upload')
        .fileupload('disable')
        .prop('disabled','disabled')
          .parent()
          .addClass("disabled"); 
      $('#id_sequence_file_upload')
        .fileupload('disable')
        .prop('disabled','disabled')
          .parent()
          .addClass("disabled");
      $('#sequenceFileUploadRow').hide();
     }


     if(data.error)
     {
        var errorHTML = ''
        for(var i=0; i<data.error.length; i++)
        { 
          data.error[i] = data.error[i].replace('Must be one of [A-Za-z?-]','Only letters and gaps allowed');
          errorHTML += (i>0?"<br>":"")+"<span class=\'errorlist\'>"+data.error[i]+"</span>";
        }
        $('#validation_div').html(errorHTML);
        if(!data.structure_file)
          $('#id_target').show();
     }
     else if(data.tpl_options)
     {
        var showSelectBox = data.tpl_options.templates.length>10;

        if(data.tpl_options.templates.length>1)
          $('#validation_div')
            .html("<div class='alert alert-warning'>For the uploaded target-template alignment, "
              +data.tpl_options.templates.length+" biounits and / or chains were found to match your template. Please select which biounit you wish to use as the template."
              +"<br><strong>You can avoid this step by using the SMTL ID as the template name in your input alignment, "
              +"<br>(SMTL ID is  &lt;PDB ID&gt;.&lt;biological assembly&gt;.&lt;Chain ID&gt;)</strong></div>"); 

    	 var msg = '';
    	 var tpl;
    	 var newHtml = '';
       if(showSelectBox)
       {
         data.tpl_options.templates.sort(function(a,b){ return a.smtl_id>b.smtl_id })
         newHtml='<div><div class="col-sm-2">Select biounit</div><div class="col-sm-10" style="margin-bottom:24px;">'
         +'<select class="form-control text-center" style="display:inline;width:auto;"><option>-</option>';
         for(var i=0; i<data.tpl_options.templates.length; i++)
         {
          var tpl = data.tpl_options.templates[i];
          newHtml+='<option onclick="$(\'#id_target\').val(\'>target\\n'+tpl.aligned_trg
              + '\\n>'+tpl.smtl_id+'\\n'+tpl.aligned_tpl+'\').trigger(\'paste\'); ">'+tpl.smtl_id+'</option>'
         }
         newHtml+='</select><button style="margin-left:10px;" type="button" class="btn btn-sm btn-default" onclick="resetForm()" ><i class="glyphicon glyphicon-refresh"></i> Reset</button></div></div>';
       }
       else
       {
      	 for(var i=0; i<data.tpl_options.templates.length; i++)
      	 {
      		 var tpl = data.tpl_options.templates[i];
           newHtml +=  '<div><div class="col-sm-2" align="center">'
      			 					+ '<a href="/templates/'+ tpl['smtl_id'].substring(0,6)+'" target="_blank">'
                      + '<img class="boxedImage" s' // Break this line, as it seems some browsers are parsing this without javascript
                      + 'rc="/templates/'+ tpl['smtl_id'].substring(0,6)+'_s100.png"'
      		 						+ 'style="margin:0;" /></a></div>'
      		            + '<div class="col-sm-10" style="margin-left:0px;">'+ $('#blankAlignment').html().replace(/TEMPLATE/g,i)
      		            + '</div></div>';
       	 }
       }

    	 $('#targetInputRow').hide();
    	 $('#alignmentSelectDiv').html(newHtml);
    	 $('#alignmentSelectDiv button:not(#addMultiTargetButton').css('display','');
    	 $('#id_project_title').val('Template Alignment: '
            +data.tpl_options.templates[0]['smtl_id'].substring(0,6));

       if(!showSelectBox)
       {
         var appendModifiedMessage = false;
      	 for(var i=0; i<data.tpl_options.templates.length; i++)
      	 {
           $('#alignScroll_'+i).resizable({ 'handles':'s',stop:function(){ $(this).width(''); }});
      		 tpl = data.tpl_options.templates[i];
      		 $('#alignTbl'+i).alignment({
      			      'templateData':
      			      {
      			       'type':'target-template',
      				     'templates':[{ 
                                'id':'tpl_'+i,
                                'pdb_id':tpl['smtl_id'].substring(0,4),
                                'qname':tpl['smtl_id'],
                                'description':tpl['description'],
                                'selected':true,
                                'offset':tpl['aligned_tpl_offset']?tpl['aligned_tpl_offset']:0, 
                                'chain':tpl['smtl_id'].split('.')[2],
                                'trg_seq':tpl['aligned_trg']?tpl['aligned_trg']:tpl['smtl_seqres'],
                                'tpl_seq':tpl['aligned_tpl']?tpl['aligned_tpl']:tpl['user_tpl']
                                }]
      			      },
      			       'cols':60
      			      }).alignment('resizeToParent');

            if(tpl['user_aligned_tpl_mm'].length>0)
            {  
              $span = $('#alignTbl'+i+' tr').not('[keyseqchain]').find('span');
              for(var j=0; j<tpl['user_aligned_tpl_mm'].length; j++)
                $span.eq(tpl['user_aligned_tpl_mm'][j]).css({'box-shadow':'0px 0px 0px 1px #D88 inset','background-color':'rgba(220,50,50,.4)'});
              appendModifiedMessage = true;
                    
            }
         }
         $('.seqIdLabel').show();
         $('[id^=gapEdit_]').show();
         if(appendModifiedMessage)
          $('#validation_div')
            .append("<div class='alert alert-warning'>The SWISS-MODEL template for "+tpl['smtl_id'].split('.')[0]+" does not match 100% with the specified template sequence in the alignment.<br> The alignment has been modified to match the template (residues marked with a red box).</div>");  
    	 }

    	 enableButtons(false,false,false);
     }//END OF ALIGNMENT OPTIONS
    else if(data.sequence!=null)
     {
      if(window.location.hash!='#alignment')
      {
        // We should not be in alignment mode here. 
        for(var i=0; i<data.sequence.length; i++)
        {
          if(i>0)
          {
            addMultiTarget();
            $('#sequenceFileUploadRow').hide();
          }

          var title = null;
          if(i==0)
          {
            title = (data.sequence[i].title?data.sequence[i].title:null);
            if(!title && data.sequence.length>1)
              title = 'Multiple target project';
          }

          addValidatedSequence(data.sequence[i].target, title);
        } 

      }
      else
      {
        $('#msa_trg_select option').remove();
        $('#msa_tpl_select option').remove();
        var tpl_selected = false;
        var trg_selected = false;
        for(var i=0; i<data.sequence.length; i++)
        {
          var obj = data.sequence[i];
          $('#msa_trg_select').append('<option seq="'+obj.target+'"'
                  +(!trg_selected?' selected="selected"':'')
                  +'>'+obj.name+'</option>');
          if(!trg_selected)
          {
            $('#msa_trg_sequence').text(obj.target);
           trg_selected = true;
          }

          if(obj.in_smtl)
          {
            if(!tpl_selected)
            {
              $('#msa_tpl_select').append('<option seq="'+obj.target+'"'
              + ' selected="selected"'
              +'>'+obj.name+'</option>');
              tpl_selected = true;
              $('#msa_tpl_sequence').text(obj.target);
            }
            else
            {
              $('#msa_tpl_select').append('<option seq="'+obj.target+'"'
              +'>'+obj.name+'</option>');
            }
          }
        } 
        if(tpl_selected)
        {
          $('#multiple_sequence_selector').show();
          $('#targetInputRow').hide();
        }
        else
        {
          $('#validation_div')
          .html("<div class='errorlist'>From the sequences you uploaded, no matching templates could be found in the SWISS-MODEL Template Library.</div>"); 
          enableButtons(false,true,true);
        } 
      }
    } 
     else if(data.structure_file)
     {
        var message = null;
        if(window.location.hash.substring(1)=='deepview' && !data.is_project_file)
        {
           data.structure_file='invalid';
           message = "The uploaded structure file is not a DeepView project file!";
        }
        if(window.location.hash.substring(1)=='structure' && data.is_project_file)
        {
           data.structure_file='invalid';
           message = "DeepView project file is not valid input for User Template mode!"
        }

        if(data.structure_file=='valid')
        {
            $('#id_template_file_upload').closest('span').after('<span id="fileUploadMessage" style="margin-left:24px;padding:5px 8px;background-color:#080" class="errorlist">'
              +(data.is_project_file?'Project File':'Template')
              +' (<i>' + data.filename + '</i>)' 
              +' Uploaded &#10003;</span>')

            if(data.is_project_file)
            {
              // Separate this logic just to make it readable
              enableButtons(true,false,true);
            }  
            else 
            {
              if (!$('#id_target').val())
                $('#validation_div')
                    .html("<span class=\'errorlist\'>Please first input a target sequence, before adding template file</span>");
              else
                enableButtons(true,false,true); 
            }
        }
        else
        {
          enableButtons(false,true,true);
          $('#inputForm').get(0).reset();
          $('#id_template_file_upload').closest('span')
          .after('<span id="fileUploadMessage" class="errorlist">'+message+'</span>');  
        }
     } 

     if(data.warning)
        $('#validation_div')
                .append("<div class='alert alert-warning'><button type='button' class='close' data-dismiss='alert'>&times;</button>"+data.warning+"</div>");   

       $('a[id^=options_]')
            .popover(
              { 
                  html : true,
                  content: function() { return $('#alignmentOptions').show()[0]; },
                  container: 'body'
              })
            .click(function()
              {
                $('#currentAlignmentIndex').val( $(this).attr('id').substring(8) );
              })
            .on("hidden",
              function()
              { 
                $('body').append($('#alignmentOptions').hide());
              });                     	    	 
}

function addValidatedSequence(sequence, title)
{
  var trgexists = false;
  $('textarea[name=target]').not('#id_target').each(function()
  {
    if( $(this).val()==sequence )
     { 
      $('#validation_div')
        .html("<div class='alert alert-warning'><button type='button' class='close' data-dismiss='alert'>&times;</button>The target sequences must be unique.</div>"); 
      $('#sequenceFileUploadRow').show();
      trgexists = true;
      return;
     }
  });
  if(trgexists)
    return;

  if(title && $('#id_project_title').val()=='')
    $('#id_project_title').val(title);
    
  $('#id_target').val(sequence);

  enableButtons(true,false,true);
  
  var targetCount = $('[id^=multiTargetInput]').length;
  var $displayedAlignment = null;
  if(targetCount>0)
  {
    $('#alignScroll__input .alignTblContainer')
        .last()
        .css('margin-bottom','24px')
        .after(
          $('#blankAlignment .alignTblContainer')
            .clone()
            .wrap('<p>')
            .parent()
            .html()
            .replace(/TEMPLATE/g,'MultiTarget'+targetCount)

        );
    $displayedAlignment = $('#alignTblMultiTarget'+targetCount);
   }
   else
   {
      $('#addMultiTargetButton').show();
      $('#id_target')
          .before(
            '<div id="singleSequence">'
              +$('#blankAlignment').html().replace(/TEMPLATE/g,'_input')
              +'</div>');
      $displayedAlignment = $('#alignTbl_input');
   }            

   $('#id_target,.seqIdLabel,[id^=gapEdit_]').hide();
   $('#alignScroll__input').resizable({ 'handles':'s',stop:function(){ $(this).width(''); }});

   $displayedAlignment.alignment({
            'templateData':
            {
             'type':'target-template',
             'templates':[{ 'trg_seq':sequence }]
            },
             'cols':60
            }).alignment('resizeToParent');
    $('#singleSequence').show();
}

function addMultiTarget()
{
  var latestTarget = $('#id_target').val().replace(/-/g,'');
  if(latestTarget.length<1)
    return;

  $('#alignScroll__input').height('100%');
  var targetCount = $('[id^=multiTargetInput]').length;
  $('#id_target')
      .before('<textarea name="target" style="display:none" id="multiTargetInput'+targetCount+'">'
          +latestTarget
          +'</textarea>'); 

  $('#alignScroll__input')
    .find('[id$=_input]')
    .each(function()
          {
            var id = $(this).attr('id');
            $(this).attr('id', id.substring(0,id.lastIndexOf('_')+1)+targetCount);          
          });
  $('#singleSequence').attr('id','multiTarget');

  $('#id_sequence_file_upload')
        .fileupload('enable')
        .prop('disabled','')
          .parent()
          .removeClass("disabled");
  $('#searchButton,#buildButton')
          .attr("disabled", "disabled")
          .addClass("disabled");
  $('#id_target').val('').show();
  $('#id_target').val('').show();


  $('#sequenceFileUploadRow').show();

  $('#addMultiTargetButton').prop('disabled', 'disabled');
}

function clearHighlightResRange()
{}
function centerResRange()
{}

function validateForm(buildModel)
{
    var selectedText = $('#alignTbl_input span.selectResidue').text();
    if(selectedText.length>0)
    {
      if(selectedText.replace(/\s/g,'').length>30) 
          $('#id_target').val(selectedText);
      else
      {
          $('#validation_div').html(
            '<span class="errorlist">The selected domain must be more than 30 residues.</span>)');
          return;
      }
    }

    $('#id_automodel').val(buildModel?'true':'false');

    $('#searchButton,#buildButton,.startJobButton')
        .attr("disabled", "disabled")
        .addClass("disabled");
	  $('#inputForm').submit();
}

function modelThis(id)
{	
    var selectedText = $('#alignTbl'+id+' span.selectResidue').text();
    if(selectedText.length>0)
    {
      if(selectedText.replace(/\s/g,'').length>30) 
       {
          var keyseq = $('#alignTbl'+id+' tr[keyseqchain]')
          var template = $('#alignTbl'+id+' tr[chain]')
          var trg='>target\n', tpl='>'+$('#alignNameTbl'+id+' tr[chain]').first().text()+'\n';

          for(var i=0; i<keyseq.length; i++)
          {
              var sel = keyseq.eq(i).find('span.selectResidue');
              if(sel.length==0)
                  sel = template.eq(i).find('span.selectResidue');
              if(sel.length==0)
                  continue;

              trg+=keyseq.eq(i).text().substring(sel.first().index(),sel.last().index()+1)
              tpl+=template.eq(i).text().substring(sel.first().index(),sel.last().index()+1)
          }
          $('#id_target').val( trg );
          $('#id_aligned_template').val( tpl );
        }
      else
      {
          $('#validation_div').html(
            '<span class="errorlist">The selected domain must be more than 30 residues.</span>');
          setTimeout(function(){$('#validation_div').html('')},4000);
          return;
      }
    }
    else
    {
      $('#alignTbl'+id).alignment('removeGappedColumns');
  
      //No highlighted residues, so use the full alignment
      var seqs =  $('#alignTbl'+id)
                  .alignment('getFormattedAlignment',{'format':'fasta'})
                  .split(/(?=^>)/m);
      $('#id_target').val( $.trim( seqs[0] ) );
      $('#id_aligned_template').val( $.trim( seqs[1] ) );
    }

  $('.startJobButton')
      .attr("disabled", "disabled")
      .addClass("disabled");

	$('#inputForm').submit();

}

function enableButtons(singleSearchButtonOn,sequenceUploadButtonOn,templateUploadButtonOn)
{
 	if(singleSearchButtonOn)
    $('#searchButton,#buildButton,#addMultiTargetButton')
          .prop("disabled", false)
          .removeClass('disabled');
  else
    $('#searchButton,#buildButton')
          .attr("disabled", "disabled")
          .addClass("disabled");

  if(sequenceUploadButtonOn)
    $('#id_sequence_file_upload')
        .fileupload('enable')
        .prop('disabled','')
          .parent()
          .removeClass("disabled");
  else
    $('#id_sequence_file_upload')
        .fileupload('disable')
        .prop('disabled','disabled')
          .parent()
          .addClass("disabled");

  if(templateUploadButtonOn)
    $('#id_template_file_upload')
        .fileupload('enable')
        .prop('disabled','')
          .parent()
          .removeClass("disabled");
  else
    $('#id_template_file_upload')
      .fileupload('disable')
      .prop('disabled','disabled')
        .parent()
        .addClass("disabled");  

  $('#validateInputButton')
    .attr("disabled", "disabled")
    .addClass("disabled");    
}

function resetForm()
{
  $('body').data('editHistory',null);
	enableButtons(false,true,false);

  if(window.location.hash=='#alignment')
  {
    $('#target_sequence_label').text("Target-Template Alignment");
    $('#id_target').attr('placeholder','Paste your target-template alignment here');
  }
  else
  {
    $('#target_sequence_label').text("Target Sequence(s)");
    $('#id_target').attr('placeholder','Paste your target sequence(s) or UniProtKB AC here');  
  }

  $('.alignTbl').first().alignment('toggleEditMode',{'edit':false})
  $('#inputForm input,textarea').not('[type=button],[name=csrfmiddlewaretoken]').val('');
  $('.errorlist,#alignmentSelectDiv,#validation_div').html('').removeClass('errorlist');
  $('#singleSequence,#fileUploadMessage,[id^=multiTarget]').remove();
  $('#multiple_sequence_selector,#addMultiTargetButton').hide();
  $('#targetInputRow,#sequenceFileUploadRow,#id_target,#projectTitleRow').show();

  if(window.location.hash=='#deepview')
  {
    $('#id_template_file_upload')
      .fileupload('enable')
      .prop('disabled','')
        .parent()
        .removeClass("disabled");
    $('#sequenceFileUploadRow').hide();
    $('#templateFileLabel').html(' Add DeepView Project File...');
    $('#templateFileUploadRow,#buildButton').show();
    $('#targetInputRow,#id_target').hide();

  }
}

</script><script>
	$('a.smng-help').append('<icon class="glyphicon glyphicon-question-sign"></i>');

	$(document).on('click','a.smng-help',function()
	{ 
		window.open($(this).attr('href'),
			'Help',
			'width=920,height=600,left=20,top=100,directories=no,menubar=yes,toolbar=yes,'
				+'status=no,scrollbars=yes,resizable=no');
		return false;
	});

	 $('a.swissmodelContactRef')
	 	.on('mouseover',function()
	 		{
	 			$(this).attr('href',["ch", ".", "nibas", "l@u",
	 		 "mode", "-swiss",
	 		  ":help", "to", "ail", "m"].reverse().join(''));
	 			$(this).off('mouseover');
	 		});

	 function showLogin()
	 {
	 	$('#loginForm')
	 		.load('/login',
	 			function()
	 			{
	 				$("<a href='#loginForm'/>'").fancybox().trigger('click');  
	 				$('#id_username').focus();

	 			});
	 	
	 } 
	 function createAccount()
	 {
	 	$('#loginForm')
	 		.load('/create_account',
	 			function()
	 			{
	 				$("<a href='#loginForm'/>'").fancybox().trigger('click'); 
	 				$('#id_username').focus(); 	
	 			});
	 }
	 
</script><!-- Google Analytics --><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-8667194-2', 'auto'); 
ga('send', 'pageview');
</script><!-- End Google Analytics --></body></html>
